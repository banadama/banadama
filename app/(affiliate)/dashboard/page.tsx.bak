// app/(affiliate)/dashboard/page.tsx
"use client";

type AffiliateStats = {
    clicks: number;
    signups: number;
    salesCount: number;
    salesVolume: number; // total order value of all referred sales
    avgCommissionRate: number; // e.g. 0.02 = 2%
    verifiedSuppliers: number;
};

const stats: AffiliateStats = {
    clicks: 1240,
    signups: 32,
    salesCount: 18,
    salesVolume: 850_000, // ₦
    avgCommissionRate: 0.02, // 2% blended rate
    verifiedSuppliers: 5,
};

function calculateEarnings(s: AffiliateStats) {
    const signupEarnings = s.signups * 50; // ₦50 per signup
    const salesCommission = s.salesVolume * s.avgCommissionRate; // 1–3% blended
    const supplierBonus = s.verifiedSuppliers * 100; // ₦100 per verified supplier
    const total = signupEarnings + salesCommission + supplierBonus;

    return {
        signupEarnings,
        salesCommission,
        supplierBonus,
        total,
    };
}

function formatCurrency(amount: number) {
    return `₦${amount.toLocaleString("en-NG", {
        maximumFractionDigits: 0,
    })}`;
}

export default function AffiliateDashboardPage() {
    const earnings = calculateEarnings(stats);

    return (
        <div className="space-y-8">
            {/* Header */}
            <div>
                <h2 className="text-2xl font-semibold text-slate-50">
                    Affiliate Dashboard
                </h2>
                <p className="mt-1 text-sm text-slate-400">
                    Track your clicks, signups, sales, and total earnings from Banadama
                    referrals.
                </p>
            </div>

            {/* Top stats cards */}
            <section className="grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
                <StatCard
                    label="Total Clicks"
                    value={stats.clicks.toLocaleString()}
                    helper="People who clicked your affiliate links"
                />
                <StatCard
                    label="Signups"
                    value={stats.signups.toString()}
                    helper="New users you referred (₦50 each)"
                />
                <StatCard
                    label="Sales"
                    value={stats.salesCount.toString()}
                    helper={`Referred orders • Volume ${formatCurrency(
                        stats.salesVolume
                    )}`}
                />
                <StatCard
                    label="Total Earnings"
                    value={formatCurrency(earnings.total)}
                    highlight
                    helper="₦50/signup + % per sale + ₦100/supplier"
                />
            </section>

            {/* Earnings breakdown */}
            <section className="grid gap-6 lg:grid-cols-2">
                <div className="rounded-xl border border-slate-800 bg-slate-900/60 p-5">
                    <h3 className="text-sm font-semibold text-slate-100">
                        Earnings Breakdown
                    </h3>
                    <p className="mt-1 text-xs text-slate-400">
                        This is how we calculated your current estimated earnings based on
                        the Banadama affiliate rules.
                    </p>

                    <dl className="mt-4 space-y-3 text-sm">
                        <BreakdownRow
                            label={`Signups (${stats.signups} × ₦50)`}
                            value={formatCurrency(earnings.signupEarnings)}
                        />
                        <BreakdownRow
                            label={`Sales commission (${formatCurrency(
                                stats.salesVolume
                            )} × ${(stats.avgCommissionRate * 100).toFixed(1)}%)`}
                            value={formatCurrency(earnings.salesCommission)}
                        />
                        <BreakdownRow
                            label={`Verified suppliers (${stats.verifiedSuppliers} × ₦100)`}
                            value={formatCurrency(earnings.supplierBonus)}
                        />

                        <div className="border-t border-slate-800 pt-3 mt-3">
                            <BreakdownRow
                                label="Total estimated earnings"
                                value={formatCurrency(earnings.total)}
                                bold
                            />
                        </div>
                    </dl>
                </div>

                {/* Notes / How it works */}
                <div className="rounded-xl border border-slate-800 bg-slate-900/60 p-5 text-sm text-slate-200">
                    <h3 className="text-sm font-semibold text-slate-100">
                        How your affiliate earnings work
                    </h3>
                    <ul className="mt-3 space-y-2 list-disc list-inside text-slate-300 text-xs sm:text-sm">
                        <li>
                            <span className="font-medium">₦50 per signup</span> – each new
                            user that creates a Banadama account from your link.
                        </li>
                        <li>
                            <span className="font-medium">1–3% per sale</span> – commission on
                            the total order value of all successful referred orders.
                        </li>
                        <li>
                            <span className="font-medium">₦100 per verified supplier</span> –
                            when a wholesaler or factory you bring gets verified on the
                            platform.
                        </li>
                        <li>
                            Payouts are handled in your local currency via the methods
                            configured in your wallet (bank, fintech, etc.).
                        </li>
                        <li>
                            All numbers on this page are estimates; final amounts are
                            confirmed at payout time.
                        </li>
                    </ul>
                </div>
            </section>
        </div>
    );
}

type StatCardProps = {
    label: string;
    value: string;
    helper?: string;
    highlight?: boolean;
};

function StatCard({ label, value, helper, highlight }: StatCardProps) {
    return (
        <div
            className={`rounded-xl border bg-slate-900/60 p-4 ${highlight ? "border-emerald-500/70" : "border-slate-800"
                }`}
        >
            <p className="text-xs uppercase tracking-wide text-slate-400">{label}</p>
            <p className="mt-2 text-2xl font-semibold text-slate-50">{value}</p>
            {helper && (
                <p className="mt-1 text-xs text-slate-500 leading-snug">{helper}</p>
            )}
        </div>
    );
}

type BreakdownRowProps = {
    label: string;
    value: string;
    bold?: boolean;
};

function BreakdownRow({ label, value, bold }: BreakdownRowProps) {
    return (
        <div className="flex items-center justify-between gap-4">
            <dt className="text-slate-300">{label}</dt>
            <dd
                className={`text-right ${bold ? "font-semibold text-emerald-400" : "text-slate-100"
                    }`}
            >
                {value}
            </dd>
        </div>
    );
}
